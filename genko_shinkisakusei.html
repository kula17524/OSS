<html lang="ja">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <link rel="stylesheet" href="css/css_genko_sakusei_PC.css">
    <link rel="stylesheet" media="screen and (max-width:960px)" href="css/css_genko_sakusei__Tab.css">
    <link rel="stylesheet" media="screen and (max-width:480px)" href="css/css_genko_sakusei_Sm.css">
    <link rel="icon" href="img/blue_icon(ico).ico">

    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <title>ReO.com-原稿作成・新規</title>
</head>
<body>
    <div class="background">
        <img id="back" src="./img/blue_background.png" alt="背景">
        <img id="sidebar" src="./img/blue_PC_side.png" alt="サイドバー">
        <img id="topbar" src="./img/blue_PC_top.png" alt="PCヘッダー">
        <img id="topbar_sm" src="./img/blue_Sm_top.png" alt="スマホヘッダー">
        <img id="logoicon" src="./img/blue_PC_titlelogo_2.png" alt="ロゴアイコン">
        <img id="label" src="./img/blue_PC_label.png" alt="ラベル">
        <img id="labeltext" src="./img/text_shinkisakusei.png" alt="PCラベルテキスト「新規作成」">
        <img id="labeltext_sm" src="./img/text_shinkisakusei_black.png" alt="スマホラベルテキスト「新規作成」">
    </div>
    <!-- ユーザーボタン -->
    <div class="user pc">
        <button type="button" class="user_button pc">
          <img
            class="user-img pc"
            src="img/blue_user_Button.png"
            alt="ユーザー情報表示ボタン"
          />
        </button>
      </div>
      <!-- ユーザー情報とログアウトリンク -->
      <nav id="user-wrap" class="pc">
        <div id="user-list" class="pc">
          <ul>
            <li><p class="pc">ログイン情報</p></li>
            <li><p id="user_mail" class="pc">Email</p></li>
            <li><a id="logout" class="pc">ログアウトする</a></li>
            <li>
              <div class="close pc"><p>×閉じる</p></div>
            </li>
          </ul>
        </div>
      </nav>
    <div class="function_button"><!--PCのみの機能ボタン-->
        <img id="saveicon" src="./img/PC_save_icon.png" alt="PC画面用セーブボタン" ontouchstart=""  draggable="false">
        <!-- モーダルウィンドウ -->
        <div id="mask" class="hidden"></div>
        <section id="modal" class="hidden">
            <p>保存しますか？</p>
            <p>タイトルに空欄や空白文字が含まれている場合、データ損失の可能性があります。</p>
            <button id="yesButton">はい</button>
            <button id="noButton">戻る</button>
        </section>
        <div id="mask_sm" class="hidden"></div>
        <section id="modal_sm" class="hidden">
            <p>保存しますか？</p>
            <p>タイトルに空欄や空白文字が含まれている場合データ損失の可能性があります。　　　</p>
            <button id="yesButtonSm">はい</button>
            <button id="noButtonSm">戻る</button>
        </section>
        <img id="exiticon" src="./img/PC_door_icon.png" alt="PC画面用戻るボタン" ontouchstart=""  draggable="false">
        <img id="emphasisButton"  src="./img/kyotyo.png" alt="「強調する」ボタン" ontouchstart=""  draggable="false">
        <img id="maButton" src="./img/ma.png" alt="「間をおく」ボタン" ontouchstart=""  draggable="false">
        <img id="miwaButton" src="./img/miwa.png" alt="「見わたす」ボタン" ontouchstart=""  draggable="false">
        <img id="kyukeiButton" src="./img/kyukei.png" alt="「休憩する」ボタン" ontouchstart=""  draggable="false">

    </div>
    <div class="sm_function"><!--スマホの機能ボタン-->
        <img id="saveicon_2" src="./img/white_hozon_Button.png" alt="スマホ画面用セーブボタン" ontouchstart=""  draggable="false" ontouchend="">
        
        <img id="back_button" src="./img/blue_back_Button.png" alt="スマホ画面用戻るボタン" ontouchstart=""  draggable="false">
        <img id="home" src="./img/blue_home_Button.png" alt="スマホ画面用ホームに戻るボタン">
    </div>
   
    <div class="textbox">
        <span class="mojisu-label">文字</span>
        <input type="number" inputmode="numeric" class="mojisu" placeholder="目標文字数" onkeyup="updateTime(value);" />
        <p id="nonumber"></p>
        <span class="time-label">分</span>
        <input type="number" inputmode="numeric" class="time" placeholder="目標時間" onkeyup="updateMojisu(value);" />
        <br>
        <input type="text" class="genko_title" placeholder="タイトル（未入力・空白文字は無効）" />
        <br>
        <br>
        <textarea id="textarea" name="main" placeholder="本文" onkeyup="Length(value);"></textarea>
        <br>
        <span class="explain_moji_label">現在の文字数</span>
        <p id="inputlength">0</p>
        <span class="gen_mojisu_label">文字</span>
        <span class="exprain_yomi_label">読み上げ時間</span>
        <p id="inputtime">0</p>
        <span class="gen_mojisu_time">分</span>
    </div>

    <script type="text/javascript" src="private.js"></script>
    <script src="js/genko_shinkisakusei.js" type="module"></script>
    <script>
        // 強調するボタンをクリックしたときの処理
        const emphasisButton = document.getElementById("emphasisButton");
        emphasisButton.addEventListener('click', () => {
            // テキストエリアに挿入
            const textarea = document.getElementById("textarea");
            const currentValue = textarea.value;
            textarea.value = currentValue + "<< 強調 >>";
        });
        //  間をおくボタンをクリックしたときの処理
        const maButton = document.getElementById("maButton");
        maButton.addEventListener('click', () => {
            // テキストエリアに挿入
            const textarea = document.getElementById("textarea");
            const currentValue = textarea.value;
            textarea.value = currentValue + "<< 間をおく >>";
        });
        //  見わたすボタンをクリックしたときの処理
        const miwaButton = document.getElementById("miwaButton");
        miwaButton.addEventListener('click', () => {
            // テキストエリアに挿入
            const textarea = document.getElementById("textarea");
            const currentValue = textarea.value;
            textarea.value = currentValue + "<< 見わたす >>";
        });
        //  休憩するボタンをクリックしたときの処理
        const kyukeiButton = document.getElementById("kyukeiButton");
        kyukeiButton.addEventListener('click', () => {
            // テキストエリアに挿入
            const textarea = document.getElementById("textarea");
            const currentValue = textarea.value;
            textarea.value = currentValue + "<< 休憩する >>";
        });

        /*目標時間・目標文字数計算*/
        function isNaturalNumber(value) {
            var parsedValue = parseInt(value, 10);
            return !isNaN(parsedValue) && parsedValue > 0;
        }

        function updateTime(value) {
            var mojisuInput = document.getElementsByClassName("mojisu")[0];
            var timeInput = document.getElementsByClassName("time")[0];

            if (isNaturalNumber(value)) {
                var mojisu = parseInt(value, 10);
                var time = (mojisu * 0.2) / 60;
                timeInput.value = time.toFixed(2);
            } else {
                timeInput.value = '';
            }
        }

        function updateMojisu(value) {
            var mojisuInput = document.getElementsByClassName("mojisu")[0];
            var timeInput = document.getElementsByClassName("time")[0];

            if (isNaturalNumber(value)) {
                var time = parseFloat(value);
                var mojisu = (time * 60) / 0.2;
                mojisuInput.value = Math.round(mojisu);
            } else {
                mojisuInput.value = '';
            }
        }

        function showLength(value) {
            // 改行文字と空白文字を取り除く
            var cleanedValue = value.replace(/\s+/g, '').replace(/\n+/g, '');
            var inputLength = document.getElementById("inputlength");
            var length = cleanedValue.length;
            inputLength.innerText = length;
        }

        /*文字数カウント*/
        function Length(str) {
            // 改行文字と空白文字を取り除く
            var cleanedStr = str.replace(/\s+/g, '').replace(/\n+/g, '');
            document.getElementById("inputlength").innerHTML = cleanedStr.length;
            const n = (cleanedStr.length * 0.2) / 60;
            document.getElementById("inputtime").innerHTML = n.toFixed(2);
        }
        // タイトルで空白禁止
        // テキストボックスの要素を取得
        const genkoTitleInput = document.querySelector('.genko_title');

        // テキストボックスの値が変更されるたびにチェックを行うイベントリスナーを追加
        genkoTitleInput.addEventListener('input', function() {
            const inputValue = genkoTitleInput.value;
            // 入力された文字列が空文字列（未入力）または空白文字（半角と全角）を含んでいるかチェック
            if (inputValue.trim() === '') {
                // アラートを表示
                alert('タイトルを入力してください。');
            } else if (/\s/.test(inputValue)) {
                // アラートを表示
                alert('空白文字は無効です。保存時にデータが失われる可能性があります。');

                // 空白文字を削除して入力欄をクリアする場合は以下のようにする
                // genkoTitleInput.value = inputValue.replace(/\s+/g, '');
            }
        });

        const savebtn = document.getElementById("saveicon");
        // 保存ボタンがクリックされたときのイベントリスナーを追加
        savebtn.addEventListener('click', () => {
            const genkoTitleInput = document.querySelector('.genko_title');
            const title = genkoTitleInput.value;

            // タイトルが空文字列（未入力）の場合にアラートを表示
            if (title.trim() === '') {
                alert('タイトルを入力してください。');
                return; // 以降の処理を中止
            }
            // Firebaseにデータを保存
            saveDataToFirebase();

            // モーダルを閉じる
            mask.classList.add('hidden');
            modal.classList.add('hidden');
        });

        const savebtn_sm = document.getElementById("saveicon_2");
        // 保存ボタンがクリックされたときのイベントリスナーを追加
        savebtn_sm.addEventListener('click', () => {
            const genkoTitleInput = document.querySelector('.genko_title');
            const title = genkoTitleInput.value;

            // タイトルが空文字列（未入力）の場合にアラートを表示
            if (title.trim() === '') {
                alert('タイトルを入力してください。');
                return; // 以降の処理を中止
            }
            // Firebaseにデータを保存
            saveDataToFirebase();

            // モーダルを閉じる
            mask_sm.classList.add('hidden');
            modal_sm.classList.add('hidden');
        });








    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="js/shinki_jquery.js"></script> 
</body>
</html>
