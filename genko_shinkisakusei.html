<html lang="ja">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <link rel="stylesheet" href="css/css_genko_sakusei_PC.css">
    <link rel="stylesheet" media="screen and (max-width:960px)" href="css/css_genko_sakusei__Tab.css">
    <link rel="stylesheet" media="screen and (max-width:480px)" href="css/css_genko_sakusei_Sm.css">
    <link rel="icon" href="img/blue_icon(ico).ico">

    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <title>ReO.com-原稿新規作成</title>
</head>
<body>
    <div class="background">
        <img id="back" src="./img/blue_background.png">
        <img id="sidebar" src="./img/blue_PC_side.png">
        <img id="topbar" src="./img/blue_PC_top.png">
        <img id="topbar_sm" src="./img/blue_Sm_top.png">
        <img id="logoicon" src="./img/blue_PC_titlelogo_2.png">
        <img id="label" src="./img/blue_PC_label.png">
        <img id="labeltext" src="./img/text_shinkisakusei.png">
        <img id="labeltext_sm" src="./img/text_shinkisakusei_black.png">
    </div>
    <!-- ユーザーボタン -->
    <div class="user">
        <button type="button" class="user_button">
          <img class="user-img" src="img/blue_user_Button.png" alt="ユーザー" />
        </button>
      </div>
      <!-- ユーザー情報とログアウトリンク -->
      <nav id="user-wrap">
        <div id="user-list">
          <ul>
            <li><p>ログイン情報</p></li>
            <li><p id="user_mail">Email</p></li>
            <li><a id="logout">ログアウトする</a></li>
            <li>
              <div class="close"><p>×閉じる</p></div>
            </li>
          </ul>
        </div>
      </nav>
    <div class="function_button"><!--PCのみの機能ボタン-->
        <img id="saveicon" src="./img/PC_save_icon.png" ontouchstart=""  draggable="false">
        <div id="mask" class="hidden"></div>
        <section id="modal" class="hidden">
        <p>保存しますか？</p>
        </section>

        <img id="exiticon" src="./img/PC_door_icon.png" ontouchstart=""  draggable="false">
    </div>
    <div class="sm_function"><!--スマホの機能ボタン-->
        <img id="saveicon_2" src="./img/blue_hozon_Button.png" ontouchstart=""  draggable="false" ontouchend="">
        <div id="mask" class="hidden"></div>
        <section id="modal" class="hidden">
        <p>保存しますか？</p>
        </section>
        <img id="back_button" src="./img/blue_back_Button.png" ontouchstart=""  draggable="false">
        <img id="home" src="./img/blue_home_Button.png">
    </div>
   
    <div class="textbox">
        <span class="mojisu-label">文字</span>
        <input type="number" inputmode="numeric" class="mojisu" placeholder="目標文字数" onkeyup="updateTime(value);" />
        <p id="nonumber"></p>
        <span class="time-label">分</span>
        <input type="number" inputmode="numeric" class="time" placeholder="目標時間" onkeyup="updateMojisu(value);" />
        <br>
        <input type="text" class="genko_title" placeholder="タイトル" />
        <br>
        <br>
        <textarea id="textarea" name="main" placeholder="本文" onkeyup="Length(value);"></textarea>
        <br>
        <span class="explain_moji_label">現在の文字数</span>
        <p id="inputlength">0</p>
        <span class="gen_mojisu_label">文字</span>
        <span class="exprain_yomi_label">読み上げ時間</span>
        <p id="inputtime">0</p>
        <span class="gen_mojisu_time">分</span>
    </div>
    
    <script>
        // ロゴをクリックするとメニュー画面に移動
        logoicon.addEventListener("click", () => {
            location.href = "index.html";
        });
        // ログイン状況を確認し、未ログインならログイン画面に遷移
        window.onload = function () {
        onAuthStateChanged(auth, (user) => {
            if (user) {
            app;
            const user = auth.currentUser;
            const email = user.email;
            document.getElementById("user_mail").innerText = email;
            } else {
            location.href = "login.html";
            }
        });
        };

        // ログアウトボタンを押下
        logout.addEventListener("click", () => {
        signOut(auth)
            .then(() => {
            location.href = "login.html";
            })
            .catch((error) => {
            console.log(`ログアウト時にエラーが発生しました (${error})`);
            });
        });

        /*目標時間・目標文字数計算*/
        function isNaturalNumber(value) {
            var parsedValue = parseInt(value, 10);
            return !isNaN(parsedValue) && parsedValue > 0;
        }

        function updateTime(value) {
            var mojisuInput = document.getElementsByClassName("mojisu")[0];
            var timeInput = document.getElementsByClassName("time")[0];

            if (isNaturalNumber(value)) {
                var mojisu = parseInt(value, 10);
                var time = (mojisu * 0.2) / 60;
                timeInput.value = time.toFixed(2);
            } else {
                timeInput.value = '';
            }
        }

        function updateMojisu(value) {
            var mojisuInput = document.getElementsByClassName("mojisu")[0];
            var timeInput = document.getElementsByClassName("time")[0];

            if (isNaturalNumber(value)) {
                var time = parseFloat(value);
                var mojisu = (time * 60) / 0.2;
                mojisuInput.value = Math.round(mojisu);
            } else {
                mojisuInput.value = '';
            }
        }

        function showLength(value) {
            var inputLength = document.getElementById("inputlength");
            var length = value.length;
            inputLength.innerText = length;
        }

        /*文字数カウント*/
        function Length(str) {
            document.getElementById("inputlength").innerHTML = str.length;
            const n = (str.length * 0.2) / 60;
            document.getElementById("inputtime").innerHTML = n.toFixed(2);
        }
        
        /*保存ボタン*/
        const savebtn = document.getElementById("saveicon");
        const mask = document.getElementById("mask");
        const modal = document.getElementById("modal");

        savebtn.addEventListener('click', () => {
            mask.classList.remove('hidden');
            modal.classList.remove('hidden');
        });

        mask.addEventListener('click', () => {
            mask.classList.add('hidden');
            modal.classList.add('hidden');
        });

        const savebtn_sm = document.getElementById("saveicon_2");
        const mask_sm = document.getElementById("mask_sm");
        const modal_sm = document.getElementById("modal_sm");

        savebtn_sm.addEventListener('click', () => {
            mask_sm.classList.remove('hidden');
            modal_sm.classList.remove('hidden');
        });

        mask_sm.addEventListener('click', () => {
            mask_sm.classList.add('hidden');
            modal_sm.classList.add('hidden');
        });

            
    </script>
</body>
</html>
